<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор материалов</title>
  <style>
    body {
      background-color: #0b1d2a;
      color: #93a7a2;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    h1 {
      color: #daa548;
      text-align: center;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #102633;
      color: #93a7a2;
      box-shadow: 0 0 10px #000;
    }
    th, td {
      border: 1px solid #1f3c4d;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #123b50;
      color: #daa548;
    }
    input[type="text"], select {
      background-color: #081c27;
      color: #00f7ff;
      border: 1px solid #1f3c4d;
      width: 140px;
      text-align: center;
    }
    .material-output {
      color: #00f7ff;
      display: inline-block;
      width: 100px;
      text-align: center;
    }
    .icon {
      width: 16px;
      height: 16px;
      vertical-align: middle;
      margin-right: 6px;
    }
    .copy-icon {
      cursor: pointer;
      margin-left: 6px;
    }
    .block {
      flex: 1;
    }
    .toggle-row {
      background-color: #081c27;
      border: 1px solid #1f3c4d;
      padding: 8px;
      text-align: center;
      margin-bottom: 10px;
      color: #daa548;
    }
  </style>
  <script>
    function formatNumberWithSpaces(value) {
      const str = value.toString().replace(/\D/g, '');
      return str.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
    }

    function parseInputToNumber(value) {
      const cleaned = value.replace(/\s+/g, '').replace(/,/g, '.');
      if (cleaned.toLowerCase().includes('трлн')) {
        const num = parseFloat(cleaned.replace(/[^\d\.]/g, ''));
        return Math.round(num * 1_000_000_000_000);
      }
      return parseInt(cleaned) || 0;
    }

    function formatTrillions(value) {
      const num = typeof value === 'number' ? value : parseInputToNumber(value);
      if (num >= 1_000_000_000_000) {
        const trillions = num / 1_000_000_000_000;
        let result = trillions.toFixed(3).replace(/\.0+$/, '').replace(/(\.\d*?)0+$/, '$1');
        return result + ' трлн';
      }
      return formatNumberWithSpaces(num);
    }

    function copyRowValue(name, input) {
      const value = input.value;
      const parsed = parseInputToNumber(value);
      const text = `${name}: ${formatNumberWithSpaces(parsed)} шт.`;
      navigator.clipboard.writeText(text).then(() => {
        alert(`Скопировано: ${text}`);
      });
    }

    document.addEventListener("DOMContentLoaded", function() {
      const toggle = document.getElementById("convertToggle");
      const selects = document.querySelectorAll("table select");
      const oreInputs = document.querySelectorAll(".ore-input");

      function updateSelectsState() {
        selects.forEach(select => {
          select.disabled = !toggle.checked;
        });
      }

      toggle.addEventListener("change", updateSelectsState);
      updateSelectsState();

      oreInputs.forEach(input => {
        let lastRawValue = input.value;

        input.addEventListener("focus", () => {
          input.value = lastRawValue;
        });

        input.addEventListener("input", () => {
          lastRawValue = input.value;
        });

        input.addEventListener("blur", () => {
          const parsed = parseInputToNumber(input.value);
          lastRawValue = formatTrillions(parsed);
          input.value = lastRawValue;
        });
      });
    });
  </script>
</head>
<body>
  <h1>Калькулятор материалов</h1>
  <div class="container">
    <!-- Левая колонка: Руда / Минералы -->
    <div class="block">
      <table>
        <thead>
          <tr>
            <th colspan="2">Руда / Минералы</th>
            <th>Количество</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><img class="icon" src="images/productions/1-16.png"></td><td>Железная руда</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Железная руда', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/2-16.png"></td><td>Полиэлементная руда</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Полиэлементная руда', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/3-16.png"></td><td>Полиорганическая руда</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Полиорганическая руда', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/4-16.png"></td><td>Уран</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Уран', this.previousElementSibling)"></td></tr>
          <tr><td colspan="3"><div style="height: 12px; width: 50%; margin: auto;"></div></td></tr>
          <tr><td><img class="icon" src="images/productions/5-16.png"></td><td>Митрацит</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Митрацит', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/6-16.png"></td><td>Иридиум</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Иридиум', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/7-16.png"></td><td>Крокит</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Крокит', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/8-16.png"></td><td>Брадий</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Брадий', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/9-16.png"></td><td>Титанит</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Титанит', this.previousElementSibling)"></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Правая колонка: Материалы -->
    <div class="block">
      <div class="toggle-row">
        <label><input type="checkbox" id="convertToggle"> Преобразовывать руду / минералы</label>
      </div>
      <table>
        <thead>
          <tr>
            <th colspan="2">Материалы</th>
            <th>Объём</th>
            <th>Количество</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><img class="icon" src="images/productions/32-16.png"></td><td>Электронные компоненты</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/46-16.png"></td><td>Алюминий</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/47-16.png"></td><td>Сталь</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/48-16.png"></td><td>Титановый сплав</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/49-16.png"></td><td>Нановолокно</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/50-16.png"></td><td>Полимеры</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/51-16.png"></td><td>Композиты</td>
            <td><select disabled><option selected>100%</option></select></td>
            <td><span class="material-output">0 трлн</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
