<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор материалов</title>
  <style>
    body {
      background-color: #0b1d2a;
      color: #93a7a2;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    h1 {
      color: #daa548;
      text-align: center;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #102633;
      color: #93a7a2;
      box-shadow: 0 0 10px #000;
    }
    th, td {
      border: 1px solid #1f3c4d;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #123b50;
      color: #daa548;
    }
    input[type="text"], select {
      background-color: #081c27;
      color: #00f7ff;
      border: 1px solid #1f3c4d;
      width: 140px;
      text-align: center;
    }
    .material-output {
      color: #00f7ff;
      display: inline-block;
      width: 100px;
      text-align: center;
    }
    .icon {
      width: 16px;
      height: 16px;
      vertical-align: middle;
      margin-right: 6px;
    }
    .copy-icon {
      cursor: pointer;
      margin-left: 6px;
    }
    .block {
      flex: 1;
    }
    .toggle-row {
      background-color: #081c27;
      border: 1px solid #1f3c4d;
      padding: 8px;
      text-align: center;
      margin-bottom: 10px;
      color: #daa548;
    }
  </style>
<script>
  const recipes = {
    "Электронные компоненты": { "Железная руда": 1, "Полиэлементная руда": 1, "Крокит": 1 },
    "Алюминий": { "Железная руда": 1, "Полиэлементная руда": 2, "Иридиум": 1 },
    "Сталь": { "Железная руда": 2, "Полиэлементная руда": 1, "Митрацит": 1 },
    "Титановый сплав": { "Железная руда": 1, "Полиэлементная руда": 1, "Титанит": 1 },
    "Нановолокно": { "Железная руда": 1, "Полиэлементная руда": 1, "Брадий": 1 },
    "Полимеры": { "Полиорганическая руда": 2, "Полиэлементная руда": 1 },
    "Композиты": { "Полиорганическая руда": 2, "Полиэлементная руда": 1, "Железная руда": 1, "Иридиум": 1, "Митрацит": 1 }
  };

  function getOreValues() {
    const oreInputs = document.querySelectorAll(".ore-input");
    const values = {};
    oreInputs.forEach(input => {
      const name = input.closest("tr").querySelector("td:nth-child(2)").textContent.trim();
      values[name] = parseInputToNumber(input.value);
    });
    return values;
  }

  function calculateMaterialsSimple() {
    const ores = getOreValues();

    document.querySelectorAll(".material-output").forEach(output => {
      const row = output.closest("tr");
      const name = row.querySelector("td:nth-child(2)").textContent.trim();
      const recipe = recipes[name];
      if (!recipe) return;

      let max = Infinity;
      for (const [ore, need] of Object.entries(recipe)) {
        const have = ores[ore] || 0;
        max = Math.min(max, Math.floor(have / need));
      }

      output.dataset.raw = max;
      output.textContent = formatTrillions(max);
    });
  }

  function copyMaterialValue(name, outputSpan) {
    const raw = outputSpan.dataset.raw || "0";
    const text = `${name}: ${formatNumberWithSpaces(raw)} шт.`;
    navigator.clipboard.writeText(text);
  }

  document.addEventListener("DOMContentLoaded", () => {
    // input → расчёт
    document.querySelectorAll(".ore-input").forEach(input => {
      let lastRawValue = input.value;

      input.addEventListener("focus", () => {
        input.value = lastRawValue;
      });

      input.addEventListener("input", () => {
        lastRawValue = input.value;
        calculateMaterialsSimple();
      });

      input.addEventListener("blur", () => {
        const parsed = parseInputToNumber(input.value);
        lastRawValue = formatTrillions(parsed);
        input.value = lastRawValue;
        calculateMaterialsSimple();
      });
    });

    calculateMaterialsSimple(); // первый запуск
  });
</script>

</head>
<body>
  <h1>Калькулятор материалов</h1>
  <div class="container">
    <!-- Левая колонка: Руда / Минералы -->
    <div class="block">
      <table>
        <thead>
          <tr>
            <th colspan="2">Руда / Минералы</th>
            <th>Количество</th>
          </tr>
        </thead>
        <tbody>
          <tr><td><img class="icon" src="images/productions/1-16.png"></td><td>Железная руда</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Железная руда', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/2-16.png"></td><td>Полиэлементная руда</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Полиэлементная руда', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/3-16.png"></td><td>Полиорганическая руда</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Полиорганическая руда', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/4-16.png"></td><td>Уран</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Уран', this.previousElementSibling)"></td></tr>
          <tr><td colspan="3"><div style="height: 12px; width: 50%; margin: auto;"></div></td></tr>
          <tr><td><img class="icon" src="images/productions/5-16.png"></td><td>Митрацит</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Митрацит', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/6-16.png"></td><td>Иридиум</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Иридиум', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/7-16.png"></td><td>Крокит</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Крокит', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/8-16.png"></td><td>Брадий</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Брадий', this.previousElementSibling)"></td></tr>
          <tr><td><img class="icon" src="images/productions/9-16.png"></td><td>Титанит</td><td><input class="ore-input" type="text" value="0"><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyRowValue('Титанит', this.previousElementSibling)"></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Правая колонка: Материалы -->
    <div class="block">
      <div class="toggle-row">
        <label><input type="checkbox" id="convertToggle"> Преобразовывать руду / минералы</label>
      </div>
      <table>
        <thead>
          <tr>
            <th colspan="2">Материалы</th>
            <th>Объём</th>
            <th>Количество</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><img class="icon" src="images/productions/32-16.png"></td><td>Электронные компоненты</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Электронные компоненты', this.previousElementSibling)"></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/46-16.png"></td><td>Алюминий</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Алюминий', this.previousElementSibling)"></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/47-16.png"></td><td>Сталь</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Сталь', this.previousElementSibling)"></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/48-16.png"></td><td>Титановый сплав</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Титановый сплав', this.previousElementSibling)"></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/49-16.png"></td><td>Нановолокно</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Нановолокно', this.previousElementSibling)"></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/50-16.png"></td><td>Полимеры</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Полимеры', this.previousElementSibling)"></td>
          </tr>
          <tr>
            <td><img class="icon" src="images/productions/51-16.png"></td><td>Композиты</td>
            <td><select>
              <option>100%</option><option>95%</option><option>90%</option><option>85%</option><option>80%</option>
              <option>75%</option><option>70%</option><option>65%</option><option>60%</option><option>55%</option>
              <option>50%</option><option>45%</option><option>40%</option><option>35%</option><option>30%</option>
              <option>25%</option><option>20%</option><option>15%</option><option>10%</option><option>5%</option>
            </select></td>
            <td><span class="material-output" data-raw="0">0</span><img class="copy-icon" src="images/productions/i-copy-16.png" onclick="copyMaterialValue('Композиты', this.previousElementSibling)"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
